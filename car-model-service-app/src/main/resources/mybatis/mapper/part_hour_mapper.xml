<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.cug.sxy.infrastructure.dao.IPartHourDao">

    <!-- 结果映射 -->
    <resultMap id="PartHourResultMap" type="cn.cug.sxy.infrastructure.dao.po.PartHourPO">
        <id column="id" property="id"/>
        <result column="part_id" property="partId"/>
        <result column="hour_id" property="hourId"/>
        <result column="created_time" property="createdTime"/>
    </resultMap>

    <!-- 基础字段 -->
    <sql id="Base_Column_List">
        id, part_id, hour_id, created_time
    </sql>

    <!-- 插入关联记录 -->
    <insert id="insert" parameterType="cn.cug.sxy.infrastructure.dao.po.PartHourPO" useGeneratedKeys="true"
            keyProperty="id">
        INSERT INTO part_hour (part_id, hour_id)
        VALUES (#{partId}, #{hourId})
    </insert>

    <!-- 删除某备件的全部关联 -->
    <delete id="deleteByPartId" parameterType="java.lang.Long">
        DELETE
        FROM part_hour
        WHERE part_id = #{partId}
    </delete>

    <!-- 删除单个关联 -->
    <delete id="deleteByPartIdAndHourId">
        DELETE
        FROM part_hour
        WHERE part_id = #{partId}
          AND hour_id = #{hourId}
    </delete>

    <!-- 判断关联是否存在 -->
    <select id="exists" resultType="boolean">
        SELECT COUNT(1) > 0
        FROM part_hour
        WHERE part_id = #{partId}
          AND hour_id = #{hourId}
    </select>

    <!-- 查询备件的所有关联 -->
    <select id="selectByPartId" parameterType="java.lang.Long" resultMap="PartHourResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM part_hour
        WHERE part_id = #{partId}
    </select>

</mapper>